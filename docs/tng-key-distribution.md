# World Health Organization Applications 
## Key Distribution Service

### Intention
The Key Distribution Service provides a template implementation for a member state backend service for a verifier application.

### General Overview
A general overview of how the different member state backends work together, can be seen in the following picture.

![KDS_Overview](docs/KDS_Overview.drawio.png "GDHCN Overview")

### Purpose and functionality of the Key Distribution Service
The Key Distribution Service (KDS) periodically mirrors the public key material from the GDHCN TRUST Network Gateway.
- SCA X.509 based trusted party Certification Authority certificates
- DSC X.509 based Document Signer certificates (signed by the trusted party CAs)
- Trusted Issuers, TLS CAs of trusted issuer resource endpoints  

The mirrored Data form up the GDHCN trustlist and can be exported as DID Documents to a CDN or a local file system for further distribution.  
As the DID based distribution is considered as the version v2 of the trustlist format, the KDS instance run by WHO exports to a directory /v2/trustlist.
The structure of the trustlist generated by KDS is described as Part of the [GDHCN Trustlist Specification](https://worldhealthorganization.github.io/smart-trust/concepts_did_gdhcn.html#did-trustlists-structure) with Version 2.0 currently in draft.  

The export reflects two different types:
- by value: the DID files of the trustlist contain the actual certificates
- by reference: the DID files of trustlist contain references to the DIDs containing the actual certificates
  (cf: [DID Trustlist Structure](https://smart.who.int/trust/did-trustlist-structure.drawio.png))  
- 
### Domestic Key Distribution Service (dKDS)
Although running as a service by WHO, KDS is designed to be deployed and run by participants as a domestic Key Distribution Service (dKDS).
Participants can tailor the export of the trustlist to their needs, e.g. by filtering the trusted issuers or by adding additional trusted party CAs.
The dKDS can be used to export the trustlist to a 'local file system' or to a CDN. Current adapters for CDN are
- Azure Blob Storage -> Azure CDN
- GitHub repository -> GitHub Pages (GitHub CDN)

### Secure connection to the GDHCN TRUST Network Gateway
The KDS connects to the GDHCN TRUST Network Gateway via a secure TLS connection with mutual authentication. 
The KDS needs to be configured with the TLS CA certificate of the GDHCN TRUST Network Gateway and a client certificate issued by a trusted TLS CA of the GDHCN TRUST Network Gateway - this typically happens when the TLS Certificate of the participant is signed and whitelisted. This Certificate can also be used for the KDS 

### Further Information
[TRUST Network Gateway Architecture](https://worldhealthorganization.github.io/smart-trust/trust_network_gateway_architecture.html#trust-network-gateway-architecture)
